SELECT
ITM.ITMREF_0 AS 'PRODUCT',
ITM.ITMDES1_0+' '+ITM.ITMDES2_0+' '+ITM.ITMDES3_0,
(
SELECT
TEXTE_0
FROM LIVE.ATEXTRA
WHERE IDENT1_0 = 21
and IDENT2_0 = ITM.TSICOD_1
and ZONE_0 = 'LNGDES'
and LANGUE_0 = 'ENG'
),
ITM.TCLCOD_0,
CAST(SUM(PRD.QTYSTU_0) AS INT) AS 'VEN RCP DC30',
PRD.STU_0 AS 'RECEIPT UOM',
(
SELECT
CAST(SUM(QTYSTU_0) AS INT)
FROM LIVE.SDELIVERYD
WHERE STOFCY_0 = 'DC30'
AND BPCORD_0 = '2100'
AND ITMREF_0 = ITM.ITMREF_0
AND CREDAT_0 >= '20230822'
) AS 'DC30 -> 2100',
(
SELECT
CAST(SUM(QTYSTU_0) AS INT)
FROM LIVE.SDELIVERYD
WHERE STOFCY_0 = '2100'
AND BPCORD_0 = 'IDC30'
AND ITMREF_0 = ITM.ITMREF_0
AND CREDAT_0 >= '20230822'
) AS '2100 -> DC30'


FROM LIVE.ITMMASTER ITM
LEFT OUTER JOIN LIVE.PRECEIPTD PRD ON ITM.ITMREF_0 = PRD.ITMREF_0

WHERE PRD.PRHFCY_0 = 'DC30'
AND PRD.CREDAT_0 >= '20230822'
AND ITM.TCLCOD_0 = 'AE'

GROUP BY 
ITM.ITMREF_0,
PRD.STU_0,
ITM.ITMDES1_0,
ITM.ITMDES2_0,
ITM.ITMDES3_0,
ITM.TSICOD_1,
ITM.TCLCOD_0

ORDER BY ITM.ITMREF_0 ASC