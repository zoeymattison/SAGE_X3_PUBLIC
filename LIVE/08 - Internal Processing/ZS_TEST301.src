#<AdxTL>@(#)0.0.0.0 $Revision$
# 1. Filter the delivery table for any unvalidated OR uninvoiced invocies.
# -> CFMFLG = 1 OR (CFMFLG = 2 & BETFCY = 1 & INVFLG = 1)
# 2. Loop through the tables and create a list of items in a global array
# -> Creation date time, Sales Site, Sold-to, Sold-to name, Delivery number, Sales order, validation status, invoice status
# -> format$([F:ZSDH]CREDATTIM), [F:ZSDH]SALFCY, [F:ZSDH]BPCORD, [F:ZBPC]BPCNAM, [F:ZSDH]SDHNUM, [F:ZSDH]SOHNUM, If YN [F:ZSDH]CFMFLG, If YN [F:ZSDH]INVFLG
# 3. Call a workflow to print the global array

If !clalev([ZSDH]) : Local File SDELIVERY [ZSDH] : Endif
If !clalev([ZBPC]) : Local File BPCUSTOMER [ZBPC] : Endif

Local Integer ZL_CURTIM : [L]ZL_CURTIM = val(format$("hhmm",func TIMEZONE_CSTD.TO_LOCAL("Pacific Standard Time",gdatetime$(datetime$))))-100 # 1 hour ago
Local Char ZL_CFMFLG
Local Char ZL_INVFLG
Global Char ZV_SDHLIST(240)(1..)
Local Shortint I : [L]I=1

Columns [ZSDH] (SDHNUM, CREDATTIM)
Columns [ZBPC] (BPCNUM, BPCNAM)
Filter [ZSDH] Where CFMFLG = 1 or (CFMFLG = 2 & BETFCY = 1 & INVFLG = 1)

For [ZSDH]
Case num$([F:ZSDH]CFMFLG)
    When "1" : [L]ZL_CFMFLG = "NO"
    When "2" : [L]ZL_CFMFLG = "YES"
Endcase
Case num$([F:ZSDH]INVFLG)
    When "1" : [L]ZL_INVFLG = "NO"
    When "2" : [L]ZL_INVFLG = "YES"
Endcase

Read [ZBPC]BPC0=[F:ZSDH]BPCORD

If val(format$("hhmm",func TIMEZONE_CSTD.TO_LOCAL("Pacific Standard Time",gdatetime$([F:ZSDH]CREDATTIM)))) <= [L]ZL_CURTIM


[V]ZV_SDHLIST([L]I) = format$("D:MM[/]DD[/]YYYY[ ]hh[:]mm",
& func TIMEZONE_CSTD.TO_LOCAL("Pacific Standard Time",
& gdatetime$([F:ZSDH]CREDATTIM)))+" "
& +[F:ZSDH]SALFCY+" "
& +[F:ZSDH]BPCORD+" "
& +[F:ZBPC]BPCNAM+" "
& +[F:ZSDH]SDHNUM+" "
& +[F:ZSDH]SOHNUM+" "
& +[L]ZL_CFMFLG+" "
& +[L]ZL_INVFLG+" "

Endif

Infbox [V]ZV_SDHLIST
[L]I+=1
Next

Kill [V]ZV_SDHLIST
